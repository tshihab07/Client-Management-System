{% extends "base.html" %}

{% block title %}Add Client — ClientMS{% endblock %}

{% block header %}Add New Client{% endblock %}

{% block head %}
<style>
    .form-card { max-width: 700px; margin: 0 auto; }
    .form-row { @apply grid grid-cols-1 md:grid-cols-2 gap-4; }
    .auto-field { @apply bg-gray-50 text-gray-700; }
</style>
<script>
    // Auto-calculate Due = Amount - Paid
    document.addEventListener('DOMContentLoaded', () => {
        const amount = document.getElementById('amount');
        const paid = document.getElementById('paid');
        const due = document.getElementById('due');

        function updateDue() {
            const a = parseFloat(amount.value) || 0;
            const p = parseFloat(paid.value) || 0;
            due.value = (a - p).toFixed(2);
            // Prevent overpayment
            if (p > a) {
                due.classList.add('text-red-600');
            } else {
                due.classList.remove('text-red-600');
            }
        }

        amount?.addEventListener('input', updateDue);
        paid?.addEventListener('input', updateDue);
    });
</script>
{% endblock %}

{% block content %}
<div class="form-card bg-white rounded-xl shadow-sm p-6">
    <form id="addClientForm" method="post" action="/api/clients" class="space-y-6">
        {% if error %}
        <div class="p-3 bg-red-50 text-red-700 border border-red-200 rounded-md">
            {{ error }}
        </div>
        {% endif %}

        <div class="form-row">
            <div>
                <label for="client_name" class="block text-sm font-medium text-gray-700 mb-1">Client Name *</label>
                <input 
                    type="text" 
                    id="client_name" 
                    name="client_name"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"
                    placeholder="e.g., John Doe"
                >
            </div>
            <div>
                <label for="project" class="block text-sm font-medium text-gray-700 mb-1">Project *</label>
                <input 
                    type="text" 
                    id="project" 
                    name="project"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"
                    placeholder="e.g., Website Redesign"
                >
            </div>
        </div>

        <div class="form-row">
            <div>
                <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                <select 
                    id="category" 
                    name="category"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"
                >
                    <option value="">Select a category</option>
                    <option value="Web Development">Web Development</option>
                    <option value="Mobile App">Mobile App</option>
                    <option value="UI/UX Design">UI/UX Design</option>
                    <option value="SEO">SEO</option>
                    <option value="Content Writing">Content Writing</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone (Optional)</label>
                <input 
                    type="tel" 
                    id="phone" 
                    name="phone"
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"
                    placeholder="e.g., +8801XXXXXXXXX"
                >
            </div>
        </div>

        <div class="form-row">
            <div>
                <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Total Amount (৳) *</label>
                <input 
                    type="number" 
                    id="amount" 
                    name="amount"
                    step="0.01"
                    min="0.01"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"
                    placeholder="e.g., 15000.00"
                >
            </div>
            <div>
                <label for="paid" class="block text-sm font-medium text-gray-700 mb-1">Paid Amount (৳) *</label>
                <input 
                    type="number" 
                    id="paid" 
                    name="paid"
                    step="0.01"
                    min="0"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"
                    placeholder="e.g., 5000.00"
                    value="0.00"
                >
            </div>
        </div>

        <div>
            <label for="due" class="block text-sm font-medium text-gray-700 mb-1">Due Amount (৳) — Auto-calculated</label>
            <input 
                type="text" 
                id="due" 
                name="due"
                readonly
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-700"
                value="0.00"
            >
            <p class="mt-1 text-xs text-gray-500">Due = Total Amount - Paid</p>
        </div>

        <div class="pt-4">
            <button 
                type="submit"
                class="px-6 py-2.5 bg-primary hover:bg-opacity-90 text-white font-medium rounded-md transition shadow-sm"
            >
                ✅ Add Client
            </button>
            <a href="/admin" class="ml-3 text-gray-600 hover:text-primary">← Cancel</a>
        </div>
    </form>
</div>

<script>
    // Form submission handler (optional: show success toast)
    document.getElementById('addClientForm')?.addEventListener('submit', function(e) {
        const amount = parseFloat(document.getElementById('amount').value);
        const paid = parseFloat(document.getElementById('paid').value);
        if (paid > amount) {
            e.preventDefault();
            alert('⚠️ Paid amount cannot exceed total amount.');
        }
    });
</script>
{% endblock %}